---
title: "Bachelorarbeit"
author: "Laura Kiemes, 12250912"
date: "`r Sys.Date()`"
output: html_document
---

# Setup

```{r setup}
knitr::opts_chunk$set(echo = TRUE)

if (!require("pacman")) install.packages("pacman"); library(pacman)
pacman::p_load(haven, readr, tidyverse)

here::i_am("project.Rmd")
```


# Data Cleaning

```{r cleaning ZA4500_patch_v2-0-0.do}
allbus2006 <- read_dta(here::here("data", "ZA4500_v2-0-0.dta")) # gesis data

allbus2006 <- allbus2006 |> 
  mutate(
    split_capi = case_when(v3 == 2 ~ 0,
                           TRUE ~ v3),
    split_capi = factor(split_capi,
                        levels = c(0, 1),
                        labels = c("CASI", "CAPI")),
    alter = case_when(v27 == 999 ~ NA,
                      TRUE ~ v26),
    immi_anpassen = case_when(v43 %in% c(1:7) ~ v43,
                              TRUE ~ NA),
    immi_heim = case_when(v44 %in% c(1:7) ~ v44,
                              TRUE ~ NA),
    immi_unpolit = case_when(v45 %in% c(1:7) ~ v45,
                              TRUE ~ NA),
    immi_heirat = case_when(v46 %in% c(1:7) ~ v46,
                              TRUE ~ NA),
    immi = 1/6 * (immi_anpassen + immi_heim + immi_unpolit + immi_heirat),
    split_selbst = case_when(v47 %in% c(1:4) ~ v47,
                             TRUE ~ NA),
    split_selbst = factor(split_selbst,
                          levels = c(1:4),
                          labels = c("ja, ohne Hilfe",
                                     "ja, Hilfe vorher",
                                     "ja, Hilfe dabei",
                                     "nein")),
    interviewer_male = case_when(v702 == 2 ~ 0, 
                                 TRUE ~ v702),
    interviewer_age = v703,
    interviewer_agediff = case_when(v703 == 999 ~ NA, 
                                    TRUE ~ abs(v703 - v27)),
    interviewer_edu = factor(v705, 
                             levels = c(1:4), 
                             labels = c("Volks-/Hauptschulabschluss",
                                        "Mittlere Reife",
                                        "(Fach-)Hochschulreife",
                                        "(Fach-)Hochschulabschluss"),
                             ordered = TRUE),
    interviewer_experience = v706
    ) 
```

```{r}
ggplot(data = allbus2006, mapping = aes(x = split_capi, y = immi)) +
  geom_boxplot() 
```


```{r save csv}
write_csv(allbus2006, here::here("data", "allbus2006.csv")) # save as csv
```

